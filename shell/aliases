#!/bin/bash

#==============================================================================
# Universal Aliases & Functions
#==============================================================================
# These aliases and functions are available on all operating systems.

alias la='ls -Fa'
alias ll='ls -Flh'
alias lla='ls -Falh'
alias ..='cd ../'
alias ...='cd ../../'
alias dcom='docker-compose'
alias dk='docker'
alias lg='lazygit'
alias wttr='curl wttr.in/fukuoka'
alias wttr2='curl v2.wttr.in/fukuoka'
alias python=python3
alias w3m="w3m -B"
alias mpc='mpc'
alias rmpc='rmpc'
alias gcl="git fetch --prune && git branch --merged | grep -vE '^\*|master$|main$|develop$' | xargs git branch -d"

# tmux wrapper to avoid library conflicts with rovodev plugin
tmux() {
    $HOME/local/bin/tmux-wrapper "$@"
}

# Function to translate English to Japanese
transej() {
    echo -n "Enter English text: "
    read -r input_text
    trans -sl=en -tl=ja "$input_text"
}

# Function to kill processes using fzf
fkill() {
  local pids
  pids=$(ps -ef | sed 1d | fzf -m --tac | awk '{print $2}')

  if [[ -z "$pids" ]]; then
    echo "No process selected."
    return
  fi

  echo "$pids" | tr ' ' '\n' | xargs -I{} sh -c 'echo "Killing PID: {} $(ps -p {} -o comm=)"; kill -9 {}'
}

#==============================================================================
# OS-Specific Aliases
#==============================================================================
# The aliases below are loaded based on the detected operating system.

case "$(uname -s)" in
    Linux*)
        # For Linux systems
        alias ls='ls --color=auto'
        alias open='xdg-open'

        if grep -q -i "microsoft" /proc/version 2>/dev/null; then
            # For WSL (Windows Subsystem for Linux)
            alias pbcopy='/mnt/c/Windows/System32/clip.exe'
            alias pbpaste='/mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe -command "Get-Clipboard"'
            alias explorer='/mnt/c/Windows/explorer.exe'
            alias notepad='/mnt/c/Windows/System32/notepad.exe'
            alias open='/mnt/c/Windows/explorer.exe'
            alias comfyui='cd ~/comfyui/ComfyUI && python main.py'
            alias comfyui-gpu='cd ~/comfyui/ComfyUI && python main.py --highvram'
            alias comfyui-fast='cd ~/comfyui/ComfyUI && python main.py --highvram --fast'
            alias openwebui='~/.local/bin/owuolm/bin/open-webui serve'
            alias webui-all='openwebui & sleep 3 && comfyui-gpu'
            # 日本語フォント関連
            alias install-fonts-jp='sudo apt update && sudo apt install -y fonts-noto-cjk fonts-noto-cjk-extra fonts-noto-color-emoji'
            alias fc-cache-refresh='fc-cache -fv'
            # 日本語入力関連
            alias fcitx5-start='env LD_LIBRARY_PATH= fcitx5 -d'
            alias fcitx-start='env LD_LIBRARY_PATH= fcitx -d'
            alias ibus-start='env LD_LIBRARY_PATH= ibus-daemon -d'
            alias install-fcitx5='sudo apt update && sudo apt install -y fcitx5 fcitx5-mozc fcitx5-config-qt'
            alias install-fcitx='sudo apt update && sudo apt install -y fcitx fcitx-mozc fcitx-config-gtk'
            alias install-ibus='sudo apt update && sudo apt install -y ibus ibus-mozc'
            # GUI関連
            alias install-gui-apps='sudo apt update && sudo apt install -y mousepad gedit firefox'
            alias setup-display='export DISPLAY=:0.0'
            alias check-x11='echo "DISPLAY: $DISPLAY" && xdpyinfo 2>/dev/null | head -5 || echo "X11サーバーが起動していません"'
        fi
        ;;
    Darwin*)
        # For macOS
        alias iclouddrive="cd ~/Library/Mobile\ Documents/com~apple~CloudDocs"
        ;;
    MINGW*|MSYS*|CYGWIN*)
        # Windows (Git Bash/MSYS2)
        alias explorer='explorer.exe'
        alias clip='clip.exe'
        alias open='explorer.exe'
        alias notepad='notepad.exe'
        ;;
esac
